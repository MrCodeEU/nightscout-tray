<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
    <Product Id="*" 
             Name="Nightscout Tray" 
             Language="1033" 
             Version="1.0.0.0" 
             Manufacturer="mrcode" 
             UpgradeCode="A1B2C3D4-E5F6-7890-ABCD-EF1234567890">
        
        <Package InstallerVersion="500" 
                 Compressed="yes" 
                 InstallScope="perUser" 
                 Description="Nightscout glucose monitoring tray application"
                 Comments="Nightscout Tray Installer" />

        <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />
        
        <MediaTemplate EmbedCab="yes" />

        <Feature Id="ProductFeature" Title="Nightscout Tray" Level="1">
            <ComponentGroupRef Id="ProductComponents" />
            <ComponentRef Id="ApplicationShortcut" />
            <ComponentRef Id="StartupShortcut" />
        </Feature>

        <Directory Id="TARGETDIR" Name="SourceDir">
            <Directory Id="LocalAppDataFolder">
                <Directory Id="INSTALLFOLDER" Name="NightscoutTray">
                    <Component Id="MainExecutable" Guid="*">
                        <File Id="NightscoutTrayExe" 
                              Source="$(var.SourceDir)\nightscout-tray.exe" 
                              KeyPath="yes" />
                    </Component>
                </Directory>
            </Directory>
            
            <Directory Id="ProgramMenuFolder">
                <Directory Id="ApplicationProgramsFolder" Name="Nightscout Tray">
                    <Component Id="ApplicationShortcut" Guid="*">
                        <Shortcut Id="ApplicationStartMenuShortcut"
                                  Name="Nightscout Tray"
                                  Description="Nightscout glucose monitoring"
                                  Target="[INSTALLFOLDER]nightscout-tray.exe"
                                  WorkingDirectory="INSTALLFOLDER" />
                        <RemoveFolder Id="CleanUpShortCut" On="uninstall" />
                        <RegistryValue Root="HKCU" 
                                       Key="Software\NightscoutTray" 
                                       Name="installed" 
                                       Type="integer" 
                                       Value="1" 
                                       KeyPath="yes" />
                    </Component>
                </Directory>
            </Directory>
            
            <Directory Id="StartupFolder">
                <Component Id="StartupShortcut" Guid="*">
                    <Condition>AUTOSTART</Condition>
                    <Shortcut Id="StartupShortcut"
                              Name="Nightscout Tray"
                              Target="[INSTALLFOLDER]nightscout-tray.exe"
                              WorkingDirectory="INSTALLFOLDER" />
                    <RegistryValue Root="HKCU"
                                   Key="Software\NightscoutTray"
                                   Name="StartupShortcut"
                                   Type="integer"
                                   Value="1"
                                   KeyPath="yes" />
                </Component>
            </Directory>
        </Directory>

        <ComponentGroup Id="ProductComponents" Directory="INSTALLFOLDER">
            <ComponentRef Id="MainExecutable" />
        </ComponentGroup>

        <Property Id="AUTOSTART" Value="0" />
        
        <Property Id="WIXUI_INSTALLDIR" Value="INSTALLFOLDER" />
        <UIRef Id="WixUI_InstallDir" />
        <WixVariable Id="WixUILicenseRtf" Value="$(var.SourceDir)\LICENSE.rtf" />
        
        <Icon Id="AppIcon.exe" SourceFile="$(var.SourceDir)\nightscout-tray.exe" />
        <Property Id="ARPPRODUCTICON" Value="AppIcon.exe" />
    </Product>
</Wix>
